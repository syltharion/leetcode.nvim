name: Sync Upstream (kawre/leetcode.nvim)

# 触发规则：
# 1. 每天凌晨 1 点（UTC 时间，对应北京时间 9 点）自动同步
# 2. 支持手动触发（在 Actions 页面点击「Run workflow」）
on:
  schedule:
    - cron: "0 1 * * *"
  # 开启手动运行
  workflow_dispatch:

# 工作流任务
jobs:
  sync-upstream:
    # 运行环境：最新版 Ubuntu
    runs-on: ubuntu-latest
    steps:
      # 步骤1：检出你的 Fork 仓库代码（分支改为 master）
      - name: Checkout Fork Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: master

      # 步骤2：配置 Git 身份（避免提交时权限报错）
      - name: Configure Git User
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      # 步骤3：添加上游仓库（kawre/leetcode.nvim）地址并拉取最新代码
      - name: Add Upstream Remote
        run: |
          git remote add upstream https://github.com/kawre/leetcode.nvim.git
          git fetch upstream

      # 步骤4：合并上游 master 分支到你的 Fork master 分支
      - name: Merge Upstream Changes
        run: |
          git checkout master
          # 快进合并上游 master 分支（无冲突自动合并，有冲突则终止）
          # 如需强制覆盖冲突，将 --ff-only 改为 -X theirs
          git merge --ff-only upstream/master || {
            echo "⚠️  同步失败：存在代码冲突，请手动解决！"
            exit 1
          }

      # 步骤5：推送合并后的代码到你的 Fork 仓库（分支改为 master）
      - name: Push to Fork Repository
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: master
